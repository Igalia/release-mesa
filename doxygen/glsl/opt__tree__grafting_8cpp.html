<html>
<head>
<title>Mesa Source Code Documentation</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head>
<body>
<div class="qindex">
<a class="qindex" href="../main/index.html">core</a> |
<a class="qindex" href="../glapi/index.html">glapi</a> |
<a class="qindex" href="../glsl/index.html">glsl</a> |
<a class="qindex" href="../nir/index.html">nir</a> |
<a class="qindex" href="../vbo/index.html">vbo</a> |
<a class="qindex" href="../math/index.html">math</a> |
<a class="qindex" href="../swrast/index.html">swrast</a> |
<a class="qindex" href="../swrast_setup/index.html">swrast_setup</a> |
<a class="qindex" href="../tnl/index.html">tnl</a> |
<a class="qindex" href="../tnl_dd/index.html">tnl_dd</a> |
<a class="qindex" href="../gbm/index.html">gbm</a> |
<a class="qindex" href="../i965/index.html">i965</a>
</div>
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_f13bc85843fa14191e0ad4a3a157cf60.html">compiler</a></li><li class="navelem"><a class="el" href="dir_4172b1ff1383a72421e897c24b01e6f0.html">glsl</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">opt_tree_grafting.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Takes assignments to variables that are dereferenced only once and pastes the RHS expression into where the variable is dereferenced.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="ir_8h.html">ir.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="ir__visitor_8h.html">ir_visitor.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="ir__variable__refcount_8h.html">ir_variable_refcount.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="ir__basic__block_8h.html">ir_basic_block.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="ir__optimization_8h.html">ir_optimization.h</a>&quot;</code><br />
<code>#include &quot;compiler/glsl_types.h&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a5ba989ad06353da096de1ef6f6484a03"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="opt__tree__grafting_8cpp.html#a5ba989ad06353da096de1ef6f6484a03">do_tree_grafting</a> (<a class="el" href="structexec__list.html">exec_list</a> *instructions)</td></tr>
<tr class="memdesc:a5ba989ad06353da096de1ef6f6484a03"><td class="mdescLeft">&#160;</td><td class="mdescRight">Does a copy propagation pass on the code present in the instruction stream.  <a href="#a5ba989ad06353da096de1ef6f6484a03">More...</a><br /></td></tr>
<tr class="separator:a5ba989ad06353da096de1ef6f6484a03"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Takes assignments to variables that are dereferenced only once and pastes the RHS expression into where the variable is dereferenced. </p>
<p>In the process of various operations like function inlining and tertiary op handling, we'll end up with our expression trees having been chopped up into a series of assignments of short expressions to temps. Other passes like ir_algebraic.cpp would prefer to see the deepest expression trees they can to try to optimize them.</p>
<p>This is a lot like copy propagaton. In comparison, copy propagation only acts on plain copies, not arbitrary expressions on the RHS. Generally, we wouldn't want to go pasting some complicated expression everywhere it got used, though, so we don't handle expressions in that pass.</p>
<p>The hard part is making sure we don't move an expression across some other assignments that would change the value of the expression. So we split this into two passes: First, find the variables in our scope which are written to once and read once, and then go through basic blocks seeing if we find an opportunity to move those expressions safely. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a5ba989ad06353da096de1ef6f6484a03"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5ba989ad06353da096de1ef6f6484a03">&sect;&nbsp;</a></span>do_tree_grafting()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool do_tree_grafting </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structexec__list.html">exec_list</a> *&#160;</td>
          <td class="paramname"><em>instructions</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Does a copy propagation pass on the code present in the instruction stream. </p>

<p>References <a class="el" href="ir__basic__block_8cpp.html#a3f98f9cf58c30c2edcb7c02149fa8821">call_for_basic_blocks()</a>, and <a class="el" href="ir__hv__accept_8cpp.html#ae09ad67f6b8034581e991d76bbc7d902">visit_list_elements()</a>.</p>

<p>Referenced by <a class="el" href="ir__optimization_8h.html#aab0cfdc8611fe7e19824c3382e8eb780">do_common_optimization()</a>, and <a class="el" href="test__optpass_8cpp.html#a8a19eefda8984dbd5d14e58acb3c3189">do_optimization()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.12
</small></address>
</body>
</html>
