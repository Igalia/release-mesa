<html>
<head>
<title>Mesa Source Code Documentation</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head>
<body>
<div class="qindex">
<a class="qindex" href="../main/index.html">core</a> |
<a class="qindex" href="../glapi/index.html">glapi</a> |
<a class="qindex" href="../glsl/index.html">glsl</a> |
<a class="qindex" href="../nir/index.html">nir</a> |
<a class="qindex" href="../vbo/index.html">vbo</a> |
<a class="qindex" href="../math/index.html">math</a> |
<a class="qindex" href="../swrast/index.html">swrast</a> |
<a class="qindex" href="../swrast_setup/index.html">swrast_setup</a> |
<a class="qindex" href="../tnl/index.html">tnl</a> |
<a class="qindex" href="../tnl_dd/index.html">tnl_dd</a> |
<a class="qindex" href="../gbm/index.html">gbm</a> |
<a class="qindex" href="../i965/index.html">i965</a>
</div>
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_9172db528ee902c60f00bbddd6d6be2b.html">mesa</a></li><li class="navelem"><a class="el" href="dir_18c0559f0dc03c9de8793d4f4d9250e0.html">drivers</a></li><li class="navelem"><a class="el" href="dir_f9d2f2c49ee9856d84d18416dd980e1f.html">dri</a></li><li class="navelem"><a class="el" href="dir_402a52f95aa7794c8781e5eebb48eed0.html">i965</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">intel_upload.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Batched upload via BOs.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="elRef" doxygen="/opt/mesa/i965/mesa/doxygen/main.tag:../main/" href="../main/imports__8h.html">main/imports.h</a>&quot;</code><br />
<code>#include &quot;<a class="elRef" doxygen="/opt/mesa/i965/mesa/doxygen/main.tag:../main/" href="../main/mtypes__8h.html">main/mtypes.h</a>&quot;</code><br />
<code>#include &quot;<a class="elRef" doxygen="/opt/mesa/i965/mesa/doxygen/main.tag:../main/" href="../main/macros__8h.html">main/macros.h</a>&quot;</code><br />
<code>#include &quot;<a class="elRef" doxygen="/opt/mesa/i965/mesa/doxygen/main.tag:../main/" href="../main/bufferobj__8h.html">main/bufferobj.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="brw__context_8h.html">brw_context.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="intel__blit_8h.html">intel_blit.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="intel__buffer__objects_8h.html">intel_buffer_objects.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="intel__batchbuffer_8h.html">intel_batchbuffer.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="intel__fbo_8h.html">intel_fbo.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="intel__mipmap__tree_8h.html">intel_mipmap_tree.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:aeb10a5a038280713c06263b239382a45"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="intel__upload_8c.html#aeb10a5a038280713c06263b239382a45">INTEL_UPLOAD_SIZE</a>&#160;&#160;&#160;(64*1024)</td></tr>
<tr class="separator:aeb10a5a038280713c06263b239382a45"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a0e559da6492e3483ff699579efb4ff36"><td class="memItemLeft" align="right" valign="top"><a class="elRef" doxygen="/opt/mesa/i965/mesa/doxygen/math.tag:../math/" href="../math/m__copy__tmp_8h.html#ac9c84fa68bbad002983e35ce3663c686">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="intel__upload_8c.html#a0e559da6492e3483ff699579efb4ff36">intel_upload_finish</a> (struct <a class="el" href="structbrw__context.html">brw_context</a> *brw)</td></tr>
<tr class="separator:a0e559da6492e3483ff699579efb4ff36"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a55d61c2b63d3d545c3d71e4f6d14047f"><td class="memItemLeft" align="right" valign="top"><a class="elRef" doxygen="/opt/mesa/i965/mesa/doxygen/math.tag:../math/" href="../math/m__copy__tmp_8h.html#ac9c84fa68bbad002983e35ce3663c686">void</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="intel__upload_8c.html#a55d61c2b63d3d545c3d71e4f6d14047f">intel_upload_space</a> (struct <a class="el" href="structbrw__context.html">brw_context</a> *brw, uint32_t size, uint32_t alignment, drm_intel_bo **out_bo, uint32_t *out_offset)</td></tr>
<tr class="memdesc:a55d61c2b63d3d545c3d71e4f6d14047f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interface for getting memory for uploading streamed data to the GPU.  <a href="#a55d61c2b63d3d545c3d71e4f6d14047f">More...</a><br /></td></tr>
<tr class="separator:a55d61c2b63d3d545c3d71e4f6d14047f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a46c838329bcfaa1f2d81d8736bb053ce"><td class="memItemLeft" align="right" valign="top"><a class="elRef" doxygen="/opt/mesa/i965/mesa/doxygen/math.tag:../math/" href="../math/m__copy__tmp_8h.html#ac9c84fa68bbad002983e35ce3663c686">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="intel__upload_8c.html#a46c838329bcfaa1f2d81d8736bb053ce">intel_upload_data</a> (struct <a class="el" href="structbrw__context.html">brw_context</a> *brw, const <a class="elRef" doxygen="/opt/mesa/i965/mesa/doxygen/math.tag:../math/" href="../math/m__copy__tmp_8h.html#ac9c84fa68bbad002983e35ce3663c686">void</a> *data, uint32_t size, uint32_t alignment, drm_intel_bo **out_bo, uint32_t *out_offset)</td></tr>
<tr class="memdesc:a46c838329bcfaa1f2d81d8736bb053ce"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handy interface to upload some data to temporary GPU memory quickly.  <a href="#a46c838329bcfaa1f2d81d8736bb053ce">More...</a><br /></td></tr>
<tr class="separator:a46c838329bcfaa1f2d81d8736bb053ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Batched upload via BOs. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="aeb10a5a038280713c06263b239382a45"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeb10a5a038280713c06263b239382a45">&sect;&nbsp;</a></span>INTEL_UPLOAD_SIZE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define INTEL_UPLOAD_SIZE&#160;&#160;&#160;(64*1024)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Referenced by <a class="el" href="intel__upload_8c.html#a55d61c2b63d3d545c3d71e4f6d14047f">intel_upload_space()</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a46c838329bcfaa1f2d81d8736bb053ce"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a46c838329bcfaa1f2d81d8736bb053ce">&sect;&nbsp;</a></span>intel_upload_data()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="elRef" doxygen="/opt/mesa/i965/mesa/doxygen/math.tag:../math/" href="../math/m__copy__tmp_8h.html#ac9c84fa68bbad002983e35ce3663c686">void</a> intel_upload_data </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbrw__context.html">brw_context</a> *&#160;</td>
          <td class="paramname"><em>brw</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="elRef" doxygen="/opt/mesa/i965/mesa/doxygen/math.tag:../math/" href="../math/m__copy__tmp_8h.html#ac9c84fa68bbad002983e35ce3663c686">void</a> *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>alignment</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">drm_intel_bo **&#160;</td>
          <td class="paramname"><em>out_bo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>out_offset</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handy interface to upload some data to temporary GPU memory quickly. </p>
<p>References to this memory should not be retained across batch flushes. </p>

<p>References <a class="el" href="intel__upload_8c.html#a55d61c2b63d3d545c3d71e4f6d14047f">intel_upload_space()</a>.</p>

<p>Referenced by <a class="el" href="brw__draw__upload_8c.html#a110a1b1128d1df3d354ac4f7ffbd8e7e">brw_prepare_shader_draw_parameters()</a>, <a class="el" href="brw__wm__surface__state_8c.html#abbf73ccd764e7bf1ea7bb491d3ae15be">brw_upload_cs_work_groups_surface()</a>, <a class="el" href="brw__draw__upload_8c.html#a49e9f6d6ef8ba7575cfe860bc83b8e82">brw_upload_indices()</a>, and <a class="el" href="brw__draw__upload_8c.html#ad2c7984d5c4966b350b1bc940f6f4cc3">copy_array_to_vbo_array()</a>.</p>

</div>
</div>
<a id="a0e559da6492e3483ff699579efb4ff36"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0e559da6492e3483ff699579efb4ff36">&sect;&nbsp;</a></span>intel_upload_finish()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="elRef" doxygen="/opt/mesa/i965/mesa/doxygen/math.tag:../math/" href="../math/m__copy__tmp_8h.html#ac9c84fa68bbad002983e35ce3663c686">void</a> intel_upload_finish </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbrw__context.html">brw_context</a> *&#160;</td>
          <td class="paramname"><em>brw</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>References <a class="el" href="structbrw__context.html#abcb8a4cf0976eeeddce63c7f357e7c8f">brw_context::bo</a>, <a class="el" href="structbrw__context.html#ac9b6f520ef8953d7c6f04d4591f20aff">brw_context::next_offset</a>, and <a class="el" href="structbrw__context.html#afe52c0f1dc56159d9ab9cda4ff7d6824">brw_context::upload</a>.</p>

<p>Referenced by <a class="el" href="intel__batchbuffer_8h.html#acf4d1d200e30633f1ee62f75ccb64acd">_intel_batchbuffer_flush_fence()</a>, and <a class="el" href="intel__upload_8c.html#a55d61c2b63d3d545c3d71e4f6d14047f">intel_upload_space()</a>.</p>

</div>
</div>
<a id="a55d61c2b63d3d545c3d71e4f6d14047f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a55d61c2b63d3d545c3d71e4f6d14047f">&sect;&nbsp;</a></span>intel_upload_space()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="elRef" doxygen="/opt/mesa/i965/mesa/doxygen/math.tag:../math/" href="../math/m__copy__tmp_8h.html#ac9c84fa68bbad002983e35ce3663c686">void</a>* intel_upload_space </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structbrw__context.html">brw_context</a> *&#160;</td>
          <td class="paramname"><em>brw</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>alignment</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">drm_intel_bo **&#160;</td>
          <td class="paramname"><em>out_bo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>out_offset</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Interface for getting memory for uploading streamed data to the GPU. </p>
<p>In most cases, streamed data (for GPU state structures, for example) is uploaded through <a class="el" href="brw__state_8h.html#a5ac38367823e29fd09ed383fe63951a9" title="Allocates a block of space in the batchbuffer for indirect state. ">brw_state_batch()</a>, since that interface allows relocations from the streamed space returned to other BOs. However, that interface has the restriction that the amount of space allocated has to be "small" (see estimated_max_prim_size in <a class="el" href="brw__draw_8c.html">brw_draw.c</a>).</p>
<p>This interface, on the other hand, is able to handle arbitrary sized allocation requests, though it will batch small allocations into the same BO for efficiency and reduced memory footprint.</p>
<dl class="section note"><dt>Note</dt><dd>The returned pointer is valid only until <a class="el" href="intel__upload_8c.html#a0e559da6492e3483ff699579efb4ff36">intel_upload_finish()</a>, which will happen at batch flush or the next <a class="el" href="intel__upload_8c.html#a55d61c2b63d3d545c3d71e4f6d14047f" title="Interface for getting memory for uploading streamed data to the GPU. ">intel_upload_space()</a>/intel_upload_data().</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">out_bo</td><td>Pointer to a BO, which must point to a valid BO or NULL on entry, and will have a reference to the new BO containing the state on return.</td></tr>
    <tr><td class="paramname">out_offset</td><td>Offset within the buffer object that the data will land. </td></tr>
  </table>
  </dd>
</dl>

<p>References <a class="el" href="structbrw__context.html#abcb8a4cf0976eeeddce63c7f357e7c8f">brw_context::bo</a>, <a class="el" href="structbrw__context.html#a09b215d26b759d54ed8f2f9c65f12ba8">brw_context::bufmgr</a>, <a class="el" href="structbrw__context.html#a610c4a6592272306465f42b46e72caa3">brw_context::has_llc</a>, <a class="el" href="intel__upload_8c.html#a0e559da6492e3483ff699579efb4ff36">intel_upload_finish()</a>, <a class="el" href="intel__upload_8c.html#aeb10a5a038280713c06263b239382a45">INTEL_UPLOAD_SIZE</a>, <a class="el" href="structbrw__context.html#ac9b6f520ef8953d7c6f04d4591f20aff">brw_context::next_offset</a>, and <a class="el" href="structbrw__context.html#afe52c0f1dc56159d9ab9cda4ff7d6824">brw_context::upload</a>.</p>

<p>Referenced by <a class="el" href="brw__curbe_8c.html#a685bd9c253cd128c6bd208e72fcde488">brw_upload_constant_buffer()</a>, <a class="el" href="brw__vs__surface__state_8c.html#ad19d3350947231e21827f300b4e17050">brw_upload_pull_constants()</a>, <a class="el" href="brw__draw__upload_8c.html#ad2c7984d5c4966b350b1bc940f6f4cc3">copy_array_to_vbo_array()</a>, and <a class="el" href="intel__upload_8c.html#a46c838329bcfaa1f2d81d8736bb053ce">intel_upload_data()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.12
</small></address>
</body>
</html>
