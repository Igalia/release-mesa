<html>
<head>
<title>Mesa Source Code Documentation</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head>
<body>
<div class="qindex">
<a class="qindex" href="../main/index.html">core</a> |
<a class="qindex" href="../glapi/index.html">glapi</a> |
<a class="qindex" href="../glsl/index.html">glsl</a> |
<a class="qindex" href="../nir/index.html">nir</a> |
<a class="qindex" href="../vbo/index.html">vbo</a> |
<a class="qindex" href="../math/index.html">math</a> |
<a class="qindex" href="../swrast/index.html">swrast</a> |
<a class="qindex" href="../swrast_setup/index.html">swrast_setup</a> |
<a class="qindex" href="../tnl/index.html">tnl</a> |
<a class="qindex" href="../tnl_dd/index.html">tnl_dd</a> |
<a class="qindex" href="../gbm/index.html">gbm</a> |
<a class="qindex" href="../i965/index.html">i965</a>
</div>
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_f13bc85843fa14191e0ad4a3a157cf60.html">compiler</a></li><li class="navelem"><a class="el" href="dir_97d747d523e0356a632e860aea1484b7.html">nir</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">nir_opt_move_comparisons.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This pass moves ALU comparison operations just before their first use.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="nir_8h.html">nir.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a26348092057d3b13f6e62407a369a158"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nir__opt__move__comparisons_8c.html#a26348092057d3b13f6e62407a369a158">is_comparison</a> (nir_op op)</td></tr>
<tr class="separator:a26348092057d3b13f6e62407a369a158"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:add1f3a8ca0fd7ecadc0a190d7a997a83"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nir__opt__move__comparisons_8c.html#add1f3a8ca0fd7ecadc0a190d7a997a83">move_comparison_source</a> (<a class="el" href="structnir__src.html">nir_src</a> *src, <a class="el" href="structnir__block.html">nir_block</a> *<a class="elRef" doxygen="/opt/mesa/i965/mesa/doxygen/glsl.tag:../glsl/" href="../glsl/structblock.html">block</a>, <a class="el" href="structnir__instr.html">nir_instr</a> *before)</td></tr>
<tr class="separator:add1f3a8ca0fd7ecadc0a190d7a997a83"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab60cb6cbaf25c494c421d5fd105d45ae"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nir__opt__move__comparisons_8c.html#ab60cb6cbaf25c494c421d5fd105d45ae">move_comparison_source_cb</a> (<a class="el" href="structnir__src.html">nir_src</a> *src, <a class="elRef" doxygen="/opt/mesa/i965/mesa/doxygen/math.tag:../math/" href="../math/m__copy__tmp_8h.html#ac9c84fa68bbad002983e35ce3663c686">void</a> *data)</td></tr>
<tr class="separator:ab60cb6cbaf25c494c421d5fd105d45ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af822ca43f243f5d6e4c75a4a76f0f816"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nir__opt__move__comparisons_8c.html#af822ca43f243f5d6e4c75a4a76f0f816">move_comparisons</a> (<a class="el" href="structnir__block.html">nir_block</a> *<a class="elRef" doxygen="/opt/mesa/i965/mesa/doxygen/glsl.tag:../glsl/" href="../glsl/structblock.html">block</a>)</td></tr>
<tr class="separator:af822ca43f243f5d6e4c75a4a76f0f816"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa49e95564e1b5257d60db6cdbe3237d2"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nir__opt__move__comparisons_8c.html#aa49e95564e1b5257d60db6cdbe3237d2">nir_opt_move_comparisons</a> (<a class="el" href="structnir__shader.html">nir_shader</a> *shader)</td></tr>
<tr class="separator:aa49e95564e1b5257d60db6cdbe3237d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This pass moves ALU comparison operations just before their first use. </p>
<p>It only moves instructions within a single basic block; cross-block movement is left to global code motion.</p>
<p>Many GPUs generate condition codes for comparisons, and use predication for conditional selects and control flow. In a sequence such as: </p><pre class="fragment">vec1 32 ssa_1 = flt a b
&lt;some other operations&gt;
vec1 32 ssa_2 = bcsel ssa_1 c d
</pre><p>the backend would likely do the comparison, producing condition codes, then save those to a boolean value. The intervening operations might trash the condition codes. Then, in order to do the bcsel, it would need to re-populate the condition code register based on the boolean.</p>
<p>By moving the comparison just before the bcsel, the condition codes could be used directly. This eliminates the need to reload them from the boolean (generally eliminating an instruction). It may also eliminate the need to create a boolean value altogether (unless it's used elsewhere), which could lower register pressure. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a26348092057d3b13f6e62407a369a158"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a26348092057d3b13f6e62407a369a158">&sect;&nbsp;</a></span>is_comparison()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool is_comparison </td>
          <td>(</td>
          <td class="paramtype">nir_op&#160;</td>
          <td class="paramname"><em>op</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Referenced by <a class="el" href="nir__opt__move__comparisons_8c.html#add1f3a8ca0fd7ecadc0a190d7a997a83">move_comparison_source()</a>.</p>

</div>
</div>
<a id="add1f3a8ca0fd7ecadc0a190d7a997a83"></a>
<h2 class="memtitle"><span class="permalink"><a href="#add1f3a8ca0fd7ecadc0a190d7a997a83">&sect;&nbsp;</a></span>move_comparison_source()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool move_comparison_source </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structnir__src.html">nir_src</a> *&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structnir__block.html">nir_block</a> *&#160;</td>
          <td class="paramname"><em>block</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structnir__instr.html">nir_instr</a> *&#160;</td>
          <td class="paramname"><em>before</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>References <a class="el" href="structnir__instr.html#a25d674b618f135289afa8609f44d690f">nir_instr::block</a>, <a class="el" href="structnir__block.html#a42aeeb76213cab1247316e5a4ca9ab77">nir_block::instr_list</a>, <a class="el" href="nir__opt__move__comparisons_8c.html#a26348092057d3b13f6e62407a369a158">is_comparison()</a>, <a class="el" href="structnir__src.html#af8ef6a1b9cbbe2132d06cec65baf0a6c">nir_src::is_ssa</a>, <a class="el" href="nir_8h.html#a5d9b6c50451cc08add06791f0f615020ac5cb218fb56fc87afa506352e58939e8">nir_instr_type_alu</a>, <a class="el" href="structnir__instr.html#ae1589d4a86d5e2eb475a73aa750d8ddb">nir_instr::node</a>, <a class="el" href="structnir__ssa__def.html#a6cac44633412450267519804948c414e">nir_ssa_def::parent_instr</a>, <a class="el" href="structnir__src.html#afdffb13b370e7550a034134e7593dbd4">nir_src::ssa</a>, and <a class="el" href="structnir__instr.html#aa9aff018f302a4c3dc7d7cb881a22095">nir_instr::type</a>.</p>

<p>Referenced by <a class="el" href="nir__opt__move__comparisons_8c.html#ab60cb6cbaf25c494c421d5fd105d45ae">move_comparison_source_cb()</a>, and <a class="el" href="nir__opt__move__comparisons_8c.html#af822ca43f243f5d6e4c75a4a76f0f816">move_comparisons()</a>.</p>

</div>
</div>
<a id="ab60cb6cbaf25c494c421d5fd105d45ae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab60cb6cbaf25c494c421d5fd105d45ae">&sect;&nbsp;</a></span>move_comparison_source_cb()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool move_comparison_source_cb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structnir__src.html">nir_src</a> *&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="elRef" doxygen="/opt/mesa/i965/mesa/doxygen/math.tag:../math/" href="../math/m__copy__tmp_8h.html#ac9c84fa68bbad002983e35ce3663c686">void</a> *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>References <a class="el" href="structnir__instr.html#a25d674b618f135289afa8609f44d690f">nir_instr::block</a>, <a class="el" href="nir_8h.html#ac7974df05fb208711a36362add7b3332">instr</a>, <a class="el" href="nir__opt__move__comparisons_8c.html#add1f3a8ca0fd7ecadc0a190d7a997a83">move_comparison_source()</a>, and <a class="el" href="structnir__src.html#a88db67cfaf47d8f2d2d1ebdcf36d6391">nir_src::parent_instr</a>.</p>

<p>Referenced by <a class="el" href="nir__opt__move__comparisons_8c.html#af822ca43f243f5d6e4c75a4a76f0f816">move_comparisons()</a>.</p>

</div>
</div>
<a id="af822ca43f243f5d6e4c75a4a76f0f816"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af822ca43f243f5d6e4c75a4a76f0f816">&sect;&nbsp;</a></span>move_comparisons()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool move_comparisons </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structnir__block.html">nir_block</a> *&#160;</td>
          <td class="paramname"><em>block</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>References <a class="el" href="structnir__if.html#a1618b713bdf4c37a65fedc9fea7db8cc">nir_if::condition</a>, <a class="el" href="nir_8h.html#ac7974df05fb208711a36362add7b3332">instr</a>, <a class="el" href="nir__opt__move__comparisons_8c.html#add1f3a8ca0fd7ecadc0a190d7a997a83">move_comparison_source()</a>, <a class="el" href="nir__opt__move__comparisons_8c.html#ab60cb6cbaf25c494c421d5fd105d45ae">move_comparison_source_cb()</a>, <a class="el" href="nir_8c.html#a694bc37f416d63c6cb1ef53c900e8190">nir_block_get_following_if()</a>, <a class="el" href="nir_8h.html#a93cb4f367043600f6cb0d5c6441b46ec">nir_foreach_instr_reverse</a>, <a class="el" href="nir_8c.html#a03da87e780f79777cc858f2e027c2ff8">nir_foreach_src()</a>, <a class="el" href="nir_8h.html#a5d9b6c50451cc08add06791f0f615020ac5cb218fb56fc87afa506352e58939e8">nir_instr_type_alu</a>, <a class="el" href="nir_8h.html#a5d9b6c50451cc08add06791f0f615020a26f78bee6e308b50858a652f683b0d4b">nir_instr_type_phi</a>, <a class="el" href="nir_8h.html#a180bd655c990cd0a7923bd128ea156ac">nir_op_infos</a>, <a class="el" href="structnir__op__info.html#a7b26c88ae99c311be1df2b35d526612b">nir_op_info::num_inputs</a>, <a class="el" href="structnir__alu__instr.html#acd6727c69e8e54fcf28574d3775497f3">nir_alu_instr::op</a>, <a class="el" href="structnir__alu__src.html#a60b5c642db92d8a5010c233dc10af56c">nir_alu_src::src</a>, and <a class="el" href="structnir__alu__instr.html#a3218457bba1f32cbc692b0a9bb05160c">nir_alu_instr::src</a>.</p>

<p>Referenced by <a class="el" href="nir__opt__move__comparisons_8c.html#aa49e95564e1b5257d60db6cdbe3237d2">nir_opt_move_comparisons()</a>.</p>

</div>
</div>
<a id="aa49e95564e1b5257d60db6cdbe3237d2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa49e95564e1b5257d60db6cdbe3237d2">&sect;&nbsp;</a></span>nir_opt_move_comparisons()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool nir_opt_move_comparisons </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structnir__shader.html">nir_shader</a> *&#160;</td>
          <td class="paramname"><em>shader</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>References <a class="el" href="nir__opt__move__comparisons_8c.html#af822ca43f243f5d6e4c75a4a76f0f816">move_comparisons()</a>, <a class="el" href="nir_8h.html#a328ac9e930619f6053a328bd0b255473">nir_foreach_block</a>, <a class="el" href="nir_8h.html#a10ac244a1642fe873a36060ac540958b">nir_foreach_function</a>, <a class="el" href="nir_8h.html#a367ba0b9b83ef7f07aa997313b4c5f6aae3590da2da54511861e4ace98587ce05">nir_metadata_block_index</a>, <a class="el" href="nir_8h.html#a367ba0b9b83ef7f07aa997313b4c5f6aab94112860ac35333dc85785875eddf64">nir_metadata_dominance</a>, <a class="el" href="nir_8h.html#a367ba0b9b83ef7f07aa997313b4c5f6aaa210ac528ad8c80a43644f45c7cb7a54">nir_metadata_live_ssa_defs</a>, and <a class="el" href="nir_8h.html#ade637f9ea894333926acf1870e1686e2">nir_metadata_preserve()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.12
</small></address>
</body>
</html>
