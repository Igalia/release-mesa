<html>
<head>
<title>Mesa Source Code Documentation</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head>
<body>
<div class="qindex">
<a class="qindex" href="../main/index.html">core</a> |
<a class="qindex" href="../glapi/index.html">glapi</a> |
<a class="qindex" href="../glsl/index.html">glsl</a> |
<a class="qindex" href="../nir/index.html">nir</a> |
<a class="qindex" href="../vbo/index.html">vbo</a> |
<a class="qindex" href="../math/index.html">math</a> |
<a class="qindex" href="../swrast/index.html">swrast</a> |
<a class="qindex" href="../swrast_setup/index.html">swrast_setup</a> |
<a class="qindex" href="../tnl/index.html">tnl</a> |
<a class="qindex" href="../tnl_dd/index.html">tnl_dd</a> |
<a class="qindex" href="../gbm/index.html">gbm</a> |
<a class="qindex" href="../i965/index.html">i965</a>
</div>
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_f13bc85843fa14191e0ad4a3a157cf60.html">compiler</a></li><li class="navelem"><a class="el" href="dir_4172b1ff1383a72421e897c24b01e6f0.html">glsl</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">ir_function_detect_recursion.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Determine whether a shader contains static recursion.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;main/core.h&quot;</code><br />
<code>#include &quot;<a class="el" href="ir_8h.html">ir.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="glsl__parser__extras_8h.html">glsl_parser_extras.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="linker_8h.html">linker.h</a>&quot;</code><br />
<code>#include &quot;util/hash_table.h&quot;</code><br />
<code>#include &quot;<a class="el" href="program_8h.html">program.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ad2bc04668112aea0e93e2d8c3e9322f8"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ir__function__detect__recursion_8cpp.html#ad2bc04668112aea0e93e2d8c3e9322f8">destroy_links</a> (<a class="el" href="structexec__list.html">exec_list</a> *list, function *f)</td></tr>
<tr class="separator:ad2bc04668112aea0e93e2d8c3e9322f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd30bc448d1477885f3b51087d3a454c"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ir__function__detect__recursion_8cpp.html#abd30bc448d1477885f3b51087d3a454c">remove_unlinked_functions</a> (const void *key, void *data, void *closure)</td></tr>
<tr class="memdesc:abd30bc448d1477885f3b51087d3a454c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove a function if it has either no in or no out links.  <a href="#abd30bc448d1477885f3b51087d3a454c">More...</a><br /></td></tr>
<tr class="separator:abd30bc448d1477885f3b51087d3a454c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a236f31245c21881743ef08c94fcaecba"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ir__function__detect__recursion_8cpp.html#a236f31245c21881743ef08c94fcaecba">emit_errors_unlinked</a> (const void *key, void *data, void *closure)</td></tr>
<tr class="separator:a236f31245c21881743ef08c94fcaecba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a70cd7f63f2d706681309c9fb0c0558"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ir__function__detect__recursion_8cpp.html#a4a70cd7f63f2d706681309c9fb0c0558">emit_errors_linked</a> (const void *key, void *data, void *closure)</td></tr>
<tr class="separator:a4a70cd7f63f2d706681309c9fb0c0558"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae739a048fdf6237296e7d702dec24a25"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ir__function__detect__recursion_8cpp.html#ae739a048fdf6237296e7d702dec24a25">detect_recursion_unlinked</a> (struct _mesa_glsl_parse_state *state, <a class="el" href="structexec__list.html">exec_list</a> *instructions)</td></tr>
<tr class="separator:ae739a048fdf6237296e7d702dec24a25"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae9003a506720cfb369d463b1e3031e69"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ir__function__detect__recursion_8cpp.html#ae9003a506720cfb369d463b1e3031e69">detect_recursion_linked</a> (struct gl_shader_program *prog, <a class="el" href="structexec__list.html">exec_list</a> *instructions)</td></tr>
<tr class="separator:ae9003a506720cfb369d463b1e3031e69"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Determine whether a shader contains static recursion. </p>
<p>Consider the (possibly disjoint) graph of function calls in a shader. If a program contains recursion, this graph will contain a cycle. If a function is part of a cycle, it will have a caller and it will have a callee (it calls another function).</p>
<p>To detect recursion, the function call graph is constructed. The graph is repeatedly reduced by removing any function that either has no callees (leaf functions) or has no caller. Eventually the only functions that remain will be the functions in the cycles.</p>
<p>The GLSL spec is a bit wishy-washy about recursion.</p>
<p>From page 39 (page 45 of the PDF) of the GLSL 1.10 spec: </p><pre class="fragment">"Behavior is undefined if recursion is used. Recursion means having any
function appearing more than once at any one time in the run-time stack
of function calls. That is, a function may not call itself either
directly or indirectly. Compilers may give diagnostic messages when
this is detectable at compile time, but not all such cases can be
detected at compile time."
</pre><p>From page 79 (page 85 of the PDF): </p><pre class="fragment">"22) Should recursion be supported?

 DISCUSSION: Probably not necessary, but another example of limiting
 the language based on how it would directly map to hardware. One
 thought is that recursion would benefit ray tracing shaders. On the
 other hand, many recursion operations can also be implemented with the
 user managing the recursion through arrays. RenderMan doesn't support
 recursion. This could be added at a later date, if it proved to be
 necessary.

 RESOLVED on September 10, 2002: Implementations are not required to
 support recursion.

 CLOSED on September 10, 2002."
</pre><p>From page 79 (page 85 of the PDF): </p><pre class="fragment">"56) Is it an error for an implementation to support recursion if the
specification says recursion is not supported?

ADDED on September 10, 2002.

DISCUSSION: This issues is related to Issue (22). If we say that
recursion (or some other piece of functionality) is not supported, is
it an error for an implementation to support it? Perhaps the
specification should remain silent on these kind of things so that they
could be gracefully added later as an extension or as part of the
standard.

RESOLUTION: Languages, in general, have programs that are not
well-formed in ways a compiler cannot detect. Portability is only
ensured for well-formed programs. Detecting recursion is an example of
this. The language will say a well-formed program may not recurse, but
compilers are not forced to detect that recursion may happen.

CLOSED: November 29, 2002."
</pre><p>In GLSL 1.10 the behavior of recursion is undefined. Compilers don't have to reject shaders (at compile-time or link-time) that contain recursion. Instead they could work, or crash, or kill a kitten.</p>
<p>From page 44 (page 50 of the PDF) of the GLSL 1.20 spec: </p><pre class="fragment">"Recursion is not allowed, not even statically. Static recursion is
present if the static function call graph of the program contains
cycles."
</pre><p>This langauge clears things up a bit, but it still leaves a lot of questions unanswered. </p><pre class="fragment">- Is the error generated at compile-time or link-time?

- Is it an error to have a recursive function that is never statically
  called by main or any function called directly or indirectly by main?
  Technically speaking, such a function is not in the "static function
  call graph of the program" at all.
</pre><dl class="bug"><dt><b><a class="el" href="bug.html#_bug000001">Bug:</a></b></dt><dd>If a shader has multiple cycles, this algorithm may erroneously complain about functions that aren't in any cycle, but are in the part of the call tree that connects them. For example, if the call graph consists of a cycle between A and B, and a cycle between D and E, and B also calls C which calls D, then this algorithm will report C as a function which "has
static recursion" even though it is not part of any cycle.</dd></dl>
<p>A better algorithm for cycle detection that doesn't have this drawback can be found here:</p>
<p><a href="http://en.wikipedia.org/wiki/Tarjan%E2%80%99s_strongly_connected_components_algorithm">http://en.wikipedia.org/wiki/Tarjan%E2%80%99s_strongly_connected_components_algorithm</a></p>
<dl class="section author"><dt>Author</dt><dd>Ian Romanick <a href="#" onclick="location.href='mai'+'lto:'+'ian'+'.d'+'.ro'+'ma'+'nic'+'k@'+'int'+'el'+'.co'+'m'; return false;">ian.d<span style="display: none;">.nosp@m.</span>.rom<span style="display: none;">.nosp@m.</span>anick<span style="display: none;">.nosp@m.</span>@int<span style="display: none;">.nosp@m.</span>el.co<span style="display: none;">.nosp@m.</span>m</a> </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="ad2bc04668112aea0e93e2d8c3e9322f8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad2bc04668112aea0e93e2d8c3e9322f8">&sect;&nbsp;</a></span>destroy_links()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void destroy_links </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structexec__list.html">exec_list</a> *&#160;</td>
          <td class="paramname"><em>list</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">function *&#160;</td>
          <td class="paramname"><em>f</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>References <a class="el" href="list_8h.html#a999fb7034eba397f7634cd844e32ff9b">foreach_in_list_safe</a>.</p>

<p>Referenced by <a class="el" href="ir__function__detect__recursion_8cpp.html#abd30bc448d1477885f3b51087d3a454c">remove_unlinked_functions()</a>.</p>

</div>
</div>
<a id="ae9003a506720cfb369d463b1e3031e69"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae9003a506720cfb369d463b1e3031e69">&sect;&nbsp;</a></span>detect_recursion_linked()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void detect_recursion_linked </td>
          <td>(</td>
          <td class="paramtype">struct gl_shader_program *&#160;</td>
          <td class="paramname"><em>prog</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structexec__list.html">exec_list</a> *&#160;</td>
          <td class="paramname"><em>instructions</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>References <a class="el" href="ir__function__detect__recursion_8cpp.html#a4a70cd7f63f2d706681309c9fb0c0558">emit_errors_linked()</a>, and <a class="el" href="ir__function__detect__recursion_8cpp.html#abd30bc448d1477885f3b51087d3a454c">remove_unlinked_functions()</a>.</p>

<p>Referenced by <a class="el" href="program_8h.html#afc0379dac600d4977ea2e7ae44096f1a">link_shaders()</a>.</p>

</div>
</div>
<a id="ae739a048fdf6237296e7d702dec24a25"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae739a048fdf6237296e7d702dec24a25">&sect;&nbsp;</a></span>detect_recursion_unlinked()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void detect_recursion_unlinked </td>
          <td>(</td>
          <td class="paramtype">struct _mesa_glsl_parse_state *&#160;</td>
          <td class="paramname"><em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structexec__list.html">exec_list</a> *&#160;</td>
          <td class="paramname"><em>instructions</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>References <a class="el" href="ir__function__detect__recursion_8cpp.html#a236f31245c21881743ef08c94fcaecba">emit_errors_unlinked()</a>, and <a class="el" href="ir__function__detect__recursion_8cpp.html#abd30bc448d1477885f3b51087d3a454c">remove_unlinked_functions()</a>.</p>

<p>Referenced by <a class="el" href="ast__to__hir_8cpp.html#a13a9b8c3eda8d5a30843e02410e656db">_mesa_ast_to_hir()</a>.</p>

</div>
</div>
<a id="a4a70cd7f63f2d706681309c9fb0c0558"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4a70cd7f63f2d706681309c9fb0c0558">&sect;&nbsp;</a></span>emit_errors_linked()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void emit_errors_linked </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>closure</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>References <a class="el" href="linker_8cpp.html#af2ae63b42d06c5aeeced547b1568e917">linker_error()</a>, and <a class="el" href="ast__function_8cpp.html#a201de0e9a762b67e9b6d313add6c8cee">prototype_string()</a>.</p>

<p>Referenced by <a class="el" href="ir__function__detect__recursion_8cpp.html#ae9003a506720cfb369d463b1e3031e69">detect_recursion_linked()</a>.</p>

</div>
</div>
<a id="a236f31245c21881743ef08c94fcaecba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a236f31245c21881743ef08c94fcaecba">&sect;&nbsp;</a></span>emit_errors_unlinked()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void emit_errors_unlinked </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>closure</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>References <a class="el" href="glsl__parser__extras_8cpp.html#a939bd788b8a9f1a21c9f2ff0dd5b3aaa">_mesa_glsl_error()</a>, and <a class="el" href="ast__function_8cpp.html#a201de0e9a762b67e9b6d313add6c8cee">prototype_string()</a>.</p>

<p>Referenced by <a class="el" href="ir__function__detect__recursion_8cpp.html#ae739a048fdf6237296e7d702dec24a25">detect_recursion_unlinked()</a>.</p>

</div>
</div>
<a id="abd30bc448d1477885f3b51087d3a454c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abd30bc448d1477885f3b51087d3a454c">&sect;&nbsp;</a></span>remove_unlinked_functions()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void remove_unlinked_functions </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>closure</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Remove a function if it has either no in or no out links. </p>

<p>References <a class="el" href="ir__function__detect__recursion_8cpp.html#ad2bc04668112aea0e93e2d8c3e9322f8">destroy_links()</a>.</p>

<p>Referenced by <a class="el" href="ir__function__detect__recursion_8cpp.html#ae9003a506720cfb369d463b1e3031e69">detect_recursion_linked()</a>, and <a class="el" href="ir__function__detect__recursion_8cpp.html#ae739a048fdf6237296e7d702dec24a25">detect_recursion_unlinked()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.12
</small></address>
</body>
</html>
